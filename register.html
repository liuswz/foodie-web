<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
	<title>商家入驻申请</title>
	<link rel="stylesheet" type="text/css" href="css/webbase.css" />
	<link rel="stylesheet" type="text/css" href="css/pages-register.css" />
	<link rel="stylesheet" href="./css/add.dishes.css">
	<link rel="stylesheet" type="text/css" href="css/cityPicker.css">

  

	<script src="./plugins/jQuery/jquery-2.2.3.min.js"></script>
	<script src="./plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="js/vue.min.js"></script>
    <script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
    <!-- <script src="https://cdn.bootcss.com/vue-validator/2.1.3/vue-validator.js"></script> -->
	<script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-4.4.4.min.js"></script>
	<!-- <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script> -->

</head>

<body >
	
	<div class="register py-container"  id="app">
		<!--head-->
		<div class="logoArea">
			<a href="" class="logo"></a>
		</div>
		<!--register-->
		<div class="registerArea">
			<h3>商家入驻申请<span class="go">我有账号，去<a href="shoplogin.html" target="_blank">登陆</a></span></h3>
			<div class="info" >
				<!-- <form @submit="checkForm"  action="http://localhost:9001/consumer/shopdetail/register"
				 novalidate="true" method="post"> -->
<div class="sui-form form-horizontal">
					<div class="control-group">
						<label class="control-label">登陆名（不可修改）：</label>
						<div class="controls">
							<input type="text" v-model.trim="shop.username" name="username" placeholder="登陆名" class="input-xfat input-xlarge">
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">登陆密码：</label>
						<div class="controls">
							<input type="password" v-model.trim="shop.password" name="password" placeholder="登陆密码" class="input-xfat input-xlarge">
						</div>
					</div>
					<div class="control-group">
							<label class="control-label">确定密码：</label>
							<div class="controls">
								<input type="password" v-model.trim="certainPassword" name="password" placeholder="确定密码" class="input-xfat input-xlarge">
							</div>
						</div>
					<div class="control-group">
						<label class="control-label">店铺名称：</label>
						<div class="controls">
							<input type="text" v-model.trim="shop.shopName" name="shopName" placeholder="店铺名称" class="input-xfat input-xlarge">
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">店铺类型：</label>
						<div class="controls">
							<select class="form-control" v-model="shop.shopTypeId">
								<option :value="type.id" v-for="type in typeList">{{type.typeName}}</option>
							</select>
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">店铺城市：</label>
						<div class="controls">
							
								<input type="text"  v-model.trim="shop.shopCity" name="shopCity" class="input-xfat input-xlarge" placeholder="请输入城市名" id="cityChoice"/>
	
								<input type="hidden" id="province" value="">
								<input type="hidden" id="city" value="">

							
							<!-- <input type="text" v-model="shop.shopCity" name="shopCity" placeholder="店铺地址" class="input-xfat input-xlarge"> -->
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">详情地址：</label>
						<div class="controls">
							<input type="text" v-model.trim="shop.shopAddress" name="shopAddress" placeholder="店铺地址" class="input-xfat input-xlarge">
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">邮箱：</label>
						<div class="controls">
							<input type="email" v-model.trim="shop.shopEmail" name="shopEmail" placeholder="邮箱" class="input-xfat input-xlarge">
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">电话：</label>
						<div class="controls">
							<input type="text" v-model.trim="shop.shopPhone" name="shopPhone" placeholder="电话" class="input-xfat input-xlarge">
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">商家logo：</label>
						<div class="controls">
							<input type="file" id="file1" @change="look_photo(1)" accept=".jpg,.png" />
						</div>
						<div class="">
							<button class="btn btn-primary" type="button" v-on:click="upload_photo(1)">
								上传
							</button>

						</div>
						
					</div>



					<div class="control-group">
							<label class="control-label"></label>
							<div class="controls">
									<img id="imgshow1" src="" width="200px" height="200px">
							</div>
                       
					</div>



					
					<div class="control-group">
						<label class="control-label">营业执照：</label>
						<div class="controls">
							<input type="file" id="file2" @change="look_photo(2)" accept=".jpg,.png" />
						</div>
						<div class="">
							<button class="btn btn-primary" type="button" v-on:click="upload_photo(2)">
								上传
							</button>
						</div>		
					</div>
					<div class="control-group">
						<label class="control-label"></label>
						<div class="controls">
								<img id="imgshow2" src="" width="200px" height="200px">
						</div>
				   
					</div>



				   <div class="control-group">
						<label class="control-label">身份证正反面图片：</label>
						<div class="controls">
							<input type="file" id="file3" @change="look_photo(3)" accept=".jpg,.png" />
						</div>
						<div class="">
							<button class="btn btn-primary" type="button" v-on:click="upload_photo(3)">
								上传
							</button>
						</div>		
					</div>
					<div class="control-group">
						<label class="control-label"></label>
						<div class="controls">
								<img id="imgshow3" src="" width="200px" height="200px">
						</div>
				   
					</div>
					<div class="control-group">
						<label class="control-label">转账二维码：</label>
						<div class="controls">
							<input type="file" id="file4" @change="look_photo(4)" accept=".jpg,.png" />
						</div>
						<div class="">
							<button class="btn btn-primary" type="button" v-on:click="upload_photo(4)">
								上传
							</button>
						</div>		
					</div>
					<div class="control-group">
						<label class="control-label"></label>
						<div class="controls">
								<img id="imgshow4" src="" width="200px" height="200px">
						</div>
				   
					</div>
					   <!-- <div class="control-group">
						<label class="control-label">mch_id：</label>
						<div class="controls">
							<input type="text" v-model="shop.mchId" name ="mchId"  placeholder="mch_id" class="input-xfat input-xlarge">
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">app_key：</label>
						<div class="controls">
							<input type="text" v-model="shop.apiKey" name ="apiKey"  placeholder="app_key" class="input-xfat input-xlarge">
						</div>
					</div> -->


					
					<div class="control-group">
						<label for="inputPassword" class="control-label">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
						<div class="controls">
							<input name="m1" type="checkbox" value="2" checked=""><span>同意协议并注册 <a href="sampling.html">《品优购商家入驻协议》</a></span>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"></label>
						<div class="controls btn-reg">
							<!-- <input class="sui-btn btn-block btn-xlarge btn-danger" type="submit" target="_blank" value="申请入驻"/> -->
							<button class="sui-btn btn-block btn-xlarge btn-danger" v-on:click="register" target="_blank">申请入驻</button>
						</div>
					</div>
					</div>
				<!-- </form> -->
				<div class="clearfix"></div>
			</div>
		</div>
		<!--foot-->
		<div class="py-container copyright">
			<ul>
				<li>关于我们</li>
				<li>联系我们</li>
				<li>联系客服</li>
				<li>商家入驻</li>
				<li>营销中心</li>
				<li>手机品优购</li>
				<li>销售联盟</li>
				<li>品优购社区</li>
			</ul>
			<div class="address">地址：北京市昌平区建材城西路金燕龙办公楼一层 邮编：100096 电话：400-618-4000 传真：010-82935100</div>
			<div class="beian">京ICP备08001421号京公网安备110108007702
			</div>
		</div>
	</div>

	<script type="text/javascript" src="js/cityData.js"></script>
	<script type="text/javascript" src="js/cityPicker.js"></script>
	<script type="text/javascript">
	 window.onload=function(){
		var cityPicker = new IIInsomniaCityPicker({
					data: cityData,
					target: '#cityChoice',
					valType: 'k-v',
					hideCityInput: '#city',
					hideProvinceInput: '#province',
					callback: function(city){
						app.shop.shopCity = $("#cityChoice").val();
					}
				});
				cityPicker.init();
	 }

   
	 
		var app =new Vue({
			el: '#app',
			data: {
				errors: [],
				typeList: [],
				dish_type: null,
				shop: {
					username: null,
					password: null,
					shopName: null,
					shopTypeId:null,
					shopCity: null,
					shopAddress: null,
					shopEmail: null,
					shopPhone: null,
					mchId: null,
					apiKey: null,
					photoUrl: null,
					businessPhoto: null,
					idcardPhoto:null,
					payPhoto:null
				},
				certainPassword:null

			},
			created: function () {
			
				this.getShopType()
			},
			methods: {
				look_photo : function(flag){
				
					var file = $('input[type="file"]')[flag-1].files[0];
				//	console.log(file);
					var reader = new FileReader();
					//使用该对象读取file文件
					reader.readAsDataURL(file);
					//读取文件成功后执行的方法函数
					reader.onload = function (e) {
						//读取成功后返回的一个参数e，整个的一个进度事件
                    
						$('#imgshow'+flag).get(0).src = e.target.result;
					}
				//	console.log("11111");
				},
			
				upload_photo: function (flag) {

					var file = $('input[type="file"]')[flag-1].files[0];
					var fileExt = file.name.substring(file.name.lastIndexOf("."))
						.toLowerCase();
                    var _this = this;
					if (!this.checkFileExt(fileExt)) {
						alert("您上传的文件不是图片,请重新上传！");
						//img.value = "";
						return;
					} else {
						var oss_name="";
						switch(flag)
						{
						case 1:
							oss_name="shop";
							break;
						case 2:
							oss_name="bussiness_photo";
							break;
						case 3:
							oss_name="idcard";
							break;
						case 4:
							oss_name="pay_photo";
							break;
						}
						var photo_name = new Date().getTime() + "" + parseInt(Math.random() * 10000 + 1);
						var last_name = "/"+oss_name+"/" + photo_name;
						client.multipartUpload(last_name, file).then(function (result) {

							// 判断系统
							// var agent = navigator.userAgent.toLowerCase();
							// var isMac = /macintosh|mac os x/i.test(navigator.userAgent);
							//console.log(result);

							//var requestUrl = result.res.requestUrls[0];
							var imgUrl="https://lanke-foodie.oss-cn-beijing.aliyuncs.com"+last_name;
							_this.insertPhotoname(flag,imgUrl);
								
								
							console.log(imgUrl);
							alert("上传成功");
							// if (isMac) {

							// //	console.log(requestUrl);
							// 	if (requestUrl) {
							// 		var imgUrl = requestUrl.substring(0, requestUrl.indexOf("?"));

							// 		_this.insertPhotoname(flag,imgUrl);
								
							
							// 		console.log(imgUrl);
							// 		alert("上传成功");
							// 	}
							// } else {
							// 	if (requestUrl) {
							// 		_this.insertPhotoname(flag,requestUrl);
								
							// 		alert("上传成功");
							// 	}
							// }
						}).catch(function (err) {
							console.log(err);
						});
					}

				},
				insertPhotoname(flag,photoName){
					switch(flag)
					{
						case 1:
							this.shop.photoUrl=photoName;
							break;
						case 2:
							this.shop.businessPhoto=photoName;
							break;
						case 3:
							this.shop.idcardPhoto=photoName;
							break;
						case 4:
							this.shop.payPhoto=photoName;
							break;
					}
				},
				checkFileExt(ext) {
					if (!ext.match(/.jpg|.gif|.png|.bmp/i)) {
						return false;
					}
					return true;
				},
				getShopType(){
					this.$http.get('http://localhost/shopconsumer/shopdetail/findAllShopType',
							 {credentials: true }).then(function (response) {
						// response.data中获取ResponseData实体

						this.typeList = response.body;
						this.shop.shopTypeId = this.typeList[0].id;
						//   alert(response.body)
					}, function (response) {
						// 发生错误
						alert("发生错误")
					});
				},
				register: function (e) {
				
					if (!this.shop.username) {
						alert('用户名不能为空');
					} else if (!this.validUsername(this.shop.username)) {
						alert('用户名只能输入5-20个 以字母开头、可带数字');
					} else if (!this.shop.password) {
						alert('密码不能为空');
					} else if (!this.validPassword(this.shop.password)) {
						alert('密码只能输入6-20个字母、数字、下划线 ');
					}else if (this.shop.password!=this.certainPassword) {
						alert('两此密码不一致');
					}
					else if (!this.shop.shopName) {
						alert('店名不能为空');
					}
					else if (!this.shop.shopTypeId) {
						alert('商铺类型不能为空');
					}
					else if (!this.shop.shopCity) {
						alert('城市不能为空');
					}
					else if (!this.shop.shopAddress) {
						alert('地址不能为空');
					}

					// else if (!this.shop.shopEmail) {
					// 	alert('邮件不能为空');
					// } else if (!this.validEmail(this.shop.shopEmail)) {
					// 	alert('邮件格式不正确 ');
					// }
					else if (!this.shop.shopPhone) {
						alert('电话号码不能为空');
					} else if (!this.validPhone(this.shop.shopPhone)) {
						alert('电话号码格式不正确');
					} else if (!this.shop.photoUrl) {
						alert('商家logo不能为空');
					}else if (!this.shop.businessPhoto) {
						alert('营业执照不能为空');
					}else if (!this.shop.idcardPhoto) {
						alert('身份证正反面不能为空');
					}else if (!this.shop.payPhoto) {
						alert('转帐二维码不能为空');
					}else{
						this.$http.post('http://localhost/shopconsumer/shopdetail/register',this.shop, {
								emulateJSON: true
							}).then(function (response) {
								// response.data中获取ResponseData实体
									console.log(response);
								alert(response.body.result);
							}, function (response) {
								// 发生错误
								alert("发生错误");
								console.log(response);
						});
						
					}



				
				},
				validUsername: function (username) {
					var re = /^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){4,19}$/;
					return re.test(username);
				},
				validPassword: function (password) {
					var re = /^(\w){6,20}$/;
					return re.test(password);
				},
				validEmail: function (email) {
					var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
					return re.test(email);
				},

				validPhone: function (phone) {
					var re = /^1([38]\d|5[0-35-9]|7[3678])\d{8}$/;
					return re.test(phone);
				},



			}
		})

		var client = new OSS.Wrapper({
			region: 'oss-cn-beijing',//你的oss地址 ，具体位置见下图
			accessKeyId: 'LTAICYbxfcsN4mvc',//你的ak
			accessKeySecret: 'Q3JmnUHAV0OvREvyhfpsxDuFEUyQSH',//你的secret
			secure: true,
			//stsToken: '<Your securityToken(STS)>',//这里我暂时没用，注销掉
			bucket: 'lanke-foodie'//你的oss名字
		});
	</script>
</body>

</html>